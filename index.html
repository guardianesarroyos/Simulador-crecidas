<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador Compacto â€“ Arroyo Escobar</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icons-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icons-512.png">
  <meta name="theme-color" content="#1976d2">
  <link rel="apple-touch-icon" href="icons/icons-192.png">
  <!-- Puedes agregar mÃ¡s tamaÃ±os si lo deseas -->
</head>
<body>

  <h1>Simulador Crecida â€“ Arroyo Escobar</h1>

  <div class="info">
    <strong>â„¹ï¸ CÃ³mo usar:</strong><br>
    ElegÃ­ la <strong>hora fin de lluvia</strong> y la <strong>altura actual</strong> del arroyo.<br>
    El modelo estima el pico y posibles impactos en casas o calles.<br>
    Este modelo es Ãºtil <strong>durante la lluvia</strong>.<br>
    No calcula acumulaciÃ³n, solo cÃ³mo crece el arroyo.
    <br><br>
    <span title="Niveles tÃ­picos: Normal: 1,30 m Â· Medio: 2,60 m Â· Â¾ Cauce: 3,10 m Â· Lleno: 3,60 m Â· Terrenos bajos: 3,70 m+ Â· Casas: 4,00 m+">
      ğŸ” Ver niveles del arroyo
    </span>
  </div>

  <div class="panel">
    <label>Altura del arroyo (m):</label>
    <input type="range" id="altura" min="0" max="5.2" step="0.1" value="2.0" oninput="updateAltura()" />
    <div class="output" id="alturaValor">2.00 m</div>

    <label>Hora fin de lluvia:</label>
    <input type="range" id="hora" min="0" max="23" step="1" value="12" oninput="updateHora()" />
    <div class="output" id="horaValor">12:00 hs</div>

    <button onclick="calcular()">Calcular Crecida</button>

    <div class="result" id="salida"></div>
  </div>

  <footer>Creado por guardianesarroyosba Â© ğŸ‡¦ğŸ‡·</footer>

  <script>
    function updateAltura() {
      const val = parseFloat(document.getElementById("altura").value).toFixed(2);
      document.getElementById("alturaValor").innerText = `${val} m`;
    }

    function updateHora() {
      const val = parseInt(document.getElementById("hora").value);
      document.getElementById("horaValor").innerText = `${val.toString().padStart(2, "0")}:00 hs`;
    }

    function calcular() {
      const alturaInicial = parseFloat(document.getElementById("altura").value);
      const horaLluvia = parseInt(document.getElementById("hora").value);

      const alturaMaxima = alturaInicial + 1;
      const horaPico = (horaLluvia + 9.5) % 24;
      const horaInicioBajada = (horaPico + 0.5) % 24;
      const horaFinBajada = (horaInicioBajada + 5.5) % 24;

      const puntosCriticos = [
        { nombre: "Terrenos bajos", nivel: 3.70 },
        { nombre: "Casa 1", nivel: 4.10 },
        { nombre: "Casa 2", nivel: 4.25 },
        { nombre: "Casa 3", nivel: 4.50 },
        { nombre: "Casa 4", nivel: 4.80 },
        { nombre: "Ruta 9", nivel: 5.20 }
      ];

      function formatoHora(h) {
        const horas = Math.floor(h);
        const minutos = (h % 1) >= 0.5 ? '30' : '00';
        return `${horas.toString().padStart(2, '0')}:${minutos}`;
      }

      function barra(altura) {
        const bloques = Math.round(altura * 2);
        return 'ğŸŸ¦'.repeat(bloques);
      }

      let salida = `
        <div class="data-grid grid-compacta">
          <div class="data-box">â±ï¸<br>Pico<br>${formatoHora(horaPico)}</div>
          <div class="data-box">ğŸ”½<br>Baja<br>${formatoHora(horaInicioBajada)}</div>
          <div class="data-box">âœ…<br>Normal<br>${formatoHora(horaFinBajada)}</div>
          <div class="data-box">ğŸ“<br>Inicial<br>${alturaInicial.toFixed(2)} m</div>
          <div class="data-box">ğŸ“ˆ<br>MÃ¡xima<br>${alturaMaxima.toFixed(2)} m</div>
        </div>`;

      const afectados = puntosCriticos.filter(p => alturaMaxima >= p.nivel).map(p => p.nombre);
      salida += `<div class="alerta">ğŸ”” ${
        afectados.length
          ? `Posible afectaciÃ³n: ${afectados.join(', ')}`
          : 'âœ… No se espera afectaciÃ³n'
      }</div>`;

      salida += `<div class="evolucion">ğŸ“Š EvoluciÃ³n: ${barra(alturaMaxima)} ${alturaMaxima.toFixed(2)} m</div>`;

      document.getElementById("salida").innerHTML = salida;
    }

    // Registro del service worker para PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }

    window.onload = () => {
      updateAltura();
      updateHora();
    };
  </script>

</body>
</html>
